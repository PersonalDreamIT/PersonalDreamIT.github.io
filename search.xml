<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>Test6</title>
    <url>/2023/02/01/Test6/</url>
    <content><![CDATA[<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">title: Test6</span><br><span class="line"><span class="built_in">date</span>: 2023-02-01 23:01:36</span><br><span class="line">categories:</span><br><span class="line">  - <span class="string">&quot;Python&quot;</span></span><br><span class="line">  - <span class="string">&quot;Java&quot;</span></span><br><span class="line">tags:</span><br><span class="line">  - <span class="string">&quot;Django&quot;</span></span><br><span class="line">  - <span class="string">&quot;Flask&quot;</span></span><br><span class="line">keywords:</span><br><span class="line">  - <span class="string">&quot;Python&quot;</span></span><br><span class="line">  - <span class="string">&quot;Java&quot;</span></span><br></pre></td></tr></table></figure>





]]></content>
      <categories>
        <category>Python</category>
        <category>Java</category>
      </categories>
      <tags>
        <tag>Django</tag>
        <tag>Flask</tag>
      </tags>
  </entry>
  <entry>
    <title>Hello World</title>
    <url>/2023/02/01/hello-world/</url>
    <content><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p>
<span id="more"></span>

<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>
<h3 id="My-Examples"><a href="#My-Examples" class="headerlink" title="My Examples"></a>My Examples</h3><pre><code class="highlight mermaid">flowchart LR

A[Hard] --&gt;|Text| B(Round)
B --&gt; C&#123;Decision&#125;
C --&gt;|One| D[Result 1]
C --&gt;|Two| E[Result 2]</code></pre>

<pre class="mermaid">
sequenceDiagram
Alice-&gt;&gt;John: Hello John, how are you?
loop Healthcheck
    John-&gt;&gt;John: Fight against hypochondria
end
Note right of John: Rational thoughts!
John--&gt;&gt;Alice: Great!
John-&gt;&gt;Bob: How about you?
Bob--&gt;&gt;John: Jolly good!
</pre>



<div class="note "><h4 id="Header"><a href="#Header" class="headerlink" title="Header"></a>Header</h4><p>(without define class style)</p>
</div>

<div class="note default"><h4 id="Default-Header"><a href="#Default-Header" class="headerlink" title="Default Header"></a>Default Header</h4><p>Welcome to <a href="https://hexo.io/">Hexo!</a></p>
</div>


<div class="tabs" id="first-unique-name"><ul class="nav-tabs"><li class="tab active"><a href="#first-unique-name-1">First unique name 1</a></li><li class="tab"><a href="#first-unique-name-2">First unique name 2</a></li><li class="tab"><a href="#first-unique-name-3">First unique name 3</a></li></ul><div class="tab-content"><div class="tab-pane active" id="first-unique-name-1"><p><strong>This is Tab 1.</strong></p></div><div class="tab-pane" id="first-unique-name-2"><p><strong>This is Tab 2.</strong></p></div><div class="tab-pane" id="first-unique-name-3"><p><strong>This is Tab 3.</strong></p></div></div></div>
]]></content>
  </entry>
  <entry>
    <title>Test7</title>
    <url>/2023/02/01/Test7/</url>
    <content><![CDATA[<span id="more"></span>


<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">title: Test7</span><br><span class="line"><span class="built_in">date</span>: 2023-02-01 23:10:29</span><br><span class="line">categories:</span><br><span class="line">  - <span class="string">&quot;C&quot;</span></span><br><span class="line">tags:</span><br><span class="line">  - <span class="string">&quot;计算器&quot;</span></span><br><span class="line">keywords:</span><br><span class="line">  - <span class="string">&quot;dev&quot;</span></span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>C</category>
      </categories>
      <tags>
        <tag>计算器</tag>
      </tags>
  </entry>
  <entry>
    <title>命令部署OpenStack-Train版-两个节点</title>
    <url>/2023/02/01/%E5%91%BD%E4%BB%A4%E9%83%A8%E7%BD%B2OpenStack-Train%E7%89%88-%E4%B8%A4%E4%B8%AA%E8%8A%82%E7%82%B9/</url>
    <content><![CDATA[<h2 id="OpenStack-Train版在线命令部署【简化版】"><a href="#OpenStack-Train版在线命令部署【简化版】" class="headerlink" title="OpenStack Train版在线命令部署【简化版】"></a>OpenStack Train版在线命令部署【简化版】</h2><blockquote>
<p>MariaDB</p>
<p>RabbitMQ</p>
<p>Memcached</p>
<p>Etcd</p>
<p>keystone</p>
<p>glance</p>
<p>nova </p>
<p>placement</p>
<p>neutron</p>
<p>以上组件部署完成，即完成了最小化部署。</p>
<p>horizon</p>
<p>cinder</p>
</blockquote>
<table>
<thead>
<tr>
<th>hostname</th>
<th>systemctl</th>
<th>host resource</th>
<th>ip</th>
</tr>
</thead>
<tbody><tr>
<td>controller</td>
<td>centos7.6</td>
<td>4C8G</td>
<td>ens32 172.16.80.11     ens33 NONE</td>
</tr>
<tr>
<td>compute</td>
<td>centos7.6</td>
<td>4C8G</td>
<td>ens32 172.16.80.12     ens33 NONE</td>
</tr>
</tbody></table>
<span id="more"></span>


<h3 id="0-init"><a href="#0-init" class="headerlink" title="0 init"></a>0 init</h3><blockquote>
<p>controller compute</p>
<p>两个节点分别初始化</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#配置网卡</span></span><br><span class="line"><span class="built_in">cat</span> /etc/sysconfig/network-scripts/ifcfg-ens32</span><br><span class="line"><span class="built_in">cat</span> &gt; /etc/sysconfig/network-scripts/ifcfg-ens33 &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">DEVICE=ens33</span></span><br><span class="line"><span class="string">TYPE=Ethernet</span></span><br><span class="line"><span class="string">ONBOOT=yes</span></span><br><span class="line"><span class="string">BOOTPROTO=none</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line">systemctl restart network</span><br><span class="line"></span><br><span class="line"><span class="comment">#配置hosts解析</span></span><br><span class="line"><span class="built_in">cat</span> &gt;&gt; /etc/hosts &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">172.16.80.11 controller</span></span><br><span class="line"><span class="string">172.16.80.12 compute</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"><span class="built_in">cat</span> /etc/hosts</span><br><span class="line"></span><br><span class="line"><span class="comment">#防火墙以及Seliunx模块</span></span><br><span class="line">systemctl stop firewalld</span><br><span class="line">systemctl <span class="built_in">disable</span> firewalld</span><br><span class="line">setenforce 0 </span><br><span class="line">sed -i <span class="string">&#x27;s/enforcing/disabled/g&#x27;</span> /etc/selinux/config </span><br><span class="line"></span><br><span class="line"><span class="comment">#配置yum源</span></span><br><span class="line">yum install vim net-tools wget -y</span><br><span class="line"><span class="built_in">mkdir</span> /etc/yum.repos.d/bak</span><br><span class="line"><span class="built_in">mv</span> /etc/yum.repos.d/*repo /etc/yum.repos.d/bak</span><br><span class="line">yum clean all &amp;&amp; yum makecache</span><br><span class="line">yum repolist</span><br><span class="line"><span class="built_in">cd</span> /etc/yum.repos.d/</span><br><span class="line"><span class="comment">#添加yum.repo</span></span><br><span class="line">yum repolist</span><br></pre></td></tr></table></figure>



<h3 id="1-time"><a href="#1-time" class="headerlink" title="1 time"></a>1 time</h3><blockquote>
<p>controller[server] compute[client]</p>
<p>两个节点部署chrony服务</p>
<p>使2个节点的时钟服务一致(这是集群服务的必要配置)</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#[controller]</span></span><br><span class="line">yum install chrony -y</span><br><span class="line"><span class="comment">#修改配置文件</span></span><br><span class="line">vim /etc/chrony.conf</span><br><span class="line"><span class="comment">#注释四行；添加一行；开启两行【删除四行，添加3行】</span></span><br><span class="line"><span class="comment">#server 0.centos.pool.ntp.org iburst</span></span><br><span class="line"><span class="comment">#server 1.centos.pool.ntp.org iburst</span></span><br><span class="line"><span class="comment">#server 2.centos.pool.ntp.org iburst</span></span><br><span class="line"><span class="comment">#server 3.centos.pool.ntp.org iburst</span></span><br><span class="line">server time5.aliyun.com iburst</span><br><span class="line">allow 172.16.80.0/24</span><br><span class="line"><span class="built_in">local</span> stratum 10</span><br><span class="line"></span><br><span class="line">[root@controller ~]<span class="comment"># egrep -v &quot;^#|^$&quot; /etc/chrony.conf </span></span><br><span class="line">server time5.aliyun.com iburst</span><br><span class="line">driftfile /var/lib/chrony/drift</span><br><span class="line">makestep 1.0 3</span><br><span class="line">rtcsync</span><br><span class="line">allow 172.16.80.0/24</span><br><span class="line"><span class="built_in">local</span> stratum 10</span><br><span class="line">logdir /var/log/chrony</span><br><span class="line"></span><br><span class="line"><span class="comment">#开启服务并检验</span></span><br><span class="line">systemctl <span class="built_in">enable</span> chronyd &amp;&amp; systemctl start chronyd </span><br><span class="line">chronyc sources           </span><br><span class="line">timedatectl </span><br><span class="line"></span><br><span class="line"><span class="comment">#[compute]</span></span><br><span class="line">yum install chrony -y</span><br><span class="line"><span class="comment">#修改配置文件</span></span><br><span class="line">vim /etc/chrony.conf</span><br><span class="line"><span class="comment">#注释四行；添加一行</span></span><br><span class="line"><span class="comment">#server 0.centos.pool.ntp.org iburst</span></span><br><span class="line"><span class="comment">#server 1.centos.pool.ntp.org iburst</span></span><br><span class="line"><span class="comment">#server 2.centos.pool.ntp.org iburst</span></span><br><span class="line"><span class="comment">#server 3.centos.pool.ntp.org iburst</span></span><br><span class="line">server controller iburst</span><br><span class="line"></span><br><span class="line">[root@compute ~]<span class="comment"># egrep -v &quot;^#|^$&quot; /etc/chrony.conf </span></span><br><span class="line">server controller iburst</span><br><span class="line">driftfile /var/lib/chrony/drift</span><br><span class="line">makestep 1.0 3</span><br><span class="line">rtcsync</span><br><span class="line">logdir /var/log/chrony</span><br><span class="line"></span><br><span class="line"><span class="comment">#开启服务并检验</span></span><br><span class="line">systemctl <span class="built_in">enable</span> chronyd &amp;&amp; systemctl start chronyd</span><br><span class="line">timedatectl</span><br><span class="line">chronyc sources</span><br></pre></td></tr></table></figure>



<h3 id="2-安装基础软件包"><a href="#2-安装基础软件包" class="headerlink" title="2 安装基础软件包"></a>2 安装基础软件包</h3><h4 id="2-1-安装OpenStack软件包"><a href="#2-1-安装OpenStack软件包" class="headerlink" title="2.1 安装OpenStack软件包"></a>2.1 <strong>安装OpenStack软件包</strong></h4><blockquote>
<p>controller compute</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#安装openstack库</span></span><br><span class="line">yum install centos-release-openstack-train -y</span><br><span class="line"><span class="comment">#更新</span></span><br><span class="line">yum upgrade -y</span><br><span class="line"><span class="comment">#重启</span></span><br><span class="line">reboot</span><br><span class="line"><span class="comment">#安装openstack客户端</span></span><br><span class="line">yum install python-openstackclient openstack-selinux openstack-utils -y</span><br></pre></td></tr></table></figure>

<h4 id="2-2-安装mariadb数据库"><a href="#2-2-安装mariadb数据库" class="headerlink" title="2.2 安装mariadb数据库"></a>2.2 <strong>安装mariadb数据库</strong></h4><blockquote>
<p>controller</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#安装软件包</span></span><br><span class="line">yum install mariadb mariadb-server python2-PyMySQL -y</span><br><span class="line"><span class="comment">#配置以下内容， bind-address设置为控制节点的管理IP地址，以使其他节点能够通过管理网络进行访问：</span></span><br><span class="line"><span class="comment">#vi /etc/my.cnf.d/openstack.cnf</span></span><br><span class="line"><span class="comment">#[mysqld]</span></span><br><span class="line"><span class="comment">#bind-address = 172.16.80.11     #绑定ip地址，跟随自己实际情况</span></span><br><span class="line"><span class="comment">#default-storage-engine = innodb   #将默认引擎改为innodb，来支持高级数据库功能</span></span><br><span class="line"><span class="comment">#innodb_file_per_table = on   #修改InnoDB为独立表空间模式</span></span><br><span class="line"><span class="comment">#max_connections = 4096    #最大连接数</span></span><br><span class="line"><span class="comment">#collation-server = utf8_general_ci</span></span><br><span class="line"><span class="comment">#character-set-server = utf8</span></span><br><span class="line"></span><br><span class="line">vim /etc/my.cnf.d/openstack.cnf    </span><br><span class="line">[mysqld]</span><br><span class="line">bind-address = 172.16.80.11</span><br><span class="line">default-storage-engine = innodb</span><br><span class="line">innodb_file_per_table = on</span><br><span class="line">max_connections = 4096</span><br><span class="line">collation-server = utf8_general_ci</span><br><span class="line">character-set-server = utf8</span><br><span class="line"></span><br><span class="line"><span class="comment">#启动数据库服务并设置服务开机启动</span></span><br><span class="line">systemctl start mariadb.service &amp;&amp; systemctl <span class="built_in">enable</span> mariadb.service </span><br><span class="line"></span><br><span class="line"><span class="comment">#运行mysql_secure_installation 脚本初始化数据库服务，并为数据库root帐户设置密码(这里设为123456)</span></span><br><span class="line">mysql_secure_installation</span><br><span class="line"></span><br><span class="line"><span class="comment">#mysql_secure_installation  #运行命令</span></span><br><span class="line"><span class="comment">#Enter current password for root (enter for none):       #直接回车</span></span><br><span class="line"><span class="comment">#Set root password? [Y/n] y   #设置密码</span></span><br><span class="line"><span class="comment">#New password:               #设置密码123456</span></span><br><span class="line"><span class="comment">#Re-enter new password:   #再次设置密码</span></span><br><span class="line"><span class="comment">#Remove anonymous users? [Y/n] y   #是否删除匿名用户</span></span><br><span class="line"><span class="comment">#Disallow root login remotely? [Y/n] n  #不允许远程登录</span></span><br><span class="line"><span class="comment">#Remove test database and access to it? [Y/n] y  #删除测试数据库并访问</span></span><br><span class="line"><span class="comment">#Reload privilege tables now? [Y/n] y   #是否重新加载特权表</span></span><br></pre></td></tr></table></figure>

<h4 id="2-3-安装RabbitMQ消息队列"><a href="#2-3-安装RabbitMQ消息队列" class="headerlink" title="2.3 安装RabbitMQ消息队列"></a>2.3 <strong>安装RabbitMQ消息队列</strong></h4><blockquote>
<p>controller</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#安装软件包</span></span><br><span class="line">yum install rabbitmq-server -y</span><br><span class="line"><span class="comment">#启动消息队列服务并设置服务开机启动</span></span><br><span class="line">systemctl <span class="built_in">enable</span> rabbitmq-server &amp;&amp; systemctl start rabbitmq-server</span><br><span class="line"><span class="comment">#添加openstack 用户，并设置密码，这里设置为123456</span></span><br><span class="line">rabbitmqctl add_user openstack 123456</span><br><span class="line"><span class="comment">#为openstack用户增加配置、读取及写入相关权限</span></span><br><span class="line">rabbitmqctl set_permissions -p / openstack <span class="string">&#x27;.*&#x27;</span> <span class="string">&#x27;.*&#x27;</span> <span class="string">&#x27;.*&#x27;</span></span><br><span class="line"><span class="comment">#设置角色 赋予管理员角色</span></span><br><span class="line">rabbitmqctl set_user_tags openstack administrator</span><br><span class="line"><span class="comment">#安装web插件（可执行也可不执行）  启动web管理界面</span></span><br><span class="line">rabbitmq-plugins <span class="built_in">enable</span> rabbitmq_management</span><br><span class="line"><span class="comment">#验证，可访问网址</span></span><br><span class="line">netstat -nltp | grep 5672 <span class="comment">#5672是默认端口，25672是测试工具cli端口</span></span><br><span class="line">http://172.16.80.11:15672 <span class="comment">#用户与密码为guest</span></span><br></pre></td></tr></table></figure>

<h4 id="2-4-安装Memcached缓存数据库"><a href="#2-4-安装Memcached缓存数据库" class="headerlink" title="2.4 安装Memcached缓存数据库"></a>2.4 <strong>安装Memcached缓存数据库</strong></h4><blockquote>
<p>controller</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#安装软件包</span></span><br><span class="line">yum install memcached python-memcached -y</span><br><span class="line"><span class="comment">#使用控制节点的管理IP地址配置服务。这使其他节点能够通过管理网络进行访问</span></span><br><span class="line">vim  /etc/sysconfig/memcached</span><br><span class="line">OPTIONS=<span class="string">&quot;-l 127.0.0.1,::1,controller&quot;</span> <span class="comment">#修改一行</span></span><br><span class="line"><span class="comment">#启动Memcached服务并将其配置为在系统引导时启动</span></span><br><span class="line">systemctl <span class="built_in">enable</span> memcached.service &amp;&amp; systemctl start memcached.service</span><br></pre></td></tr></table></figure>

<h4 id="2-5-安装Etcd服务"><a href="#2-5-安装Etcd服务" class="headerlink" title="2.5 安装Etcd服务"></a>2.5 <strong>安装Etcd服务</strong></h4><blockquote>
<p>controller</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#安装软件包</span></span><br><span class="line">yum install etcd -y</span><br><span class="line"></span><br><span class="line"><span class="comment">#编辑/etc/etcd/etcd.conf文件，以控制节点管理IP地址设置相关选项，以使其他节点通过管理网络进行访问</span></span><br><span class="line">vim /etc/etcd/etcd.conf            </span><br><span class="line"><span class="comment">#:%s/localhost/172.16.80.11/g  </span></span><br><span class="line"><span class="comment">#可以使用:%s/localhost/172.16.80.11/g 实现替换</span></span><br><span class="line"><span class="comment">#[Member]</span></span><br><span class="line">ETCD_DATA_DIR=<span class="string">&quot;/var/lib/etcd/default.etcd&quot;</span></span><br><span class="line">ETCD_LISTEN_PEER_URLS=<span class="string">&quot;http://172.16.80.11:2380&quot;</span>    <span class="comment">#将localhost改成自己的ip</span></span><br><span class="line">ETCD_LISTEN_CLIENT_URLS=<span class="string">&quot;http://172.16.80.11:2379&quot;</span>   </span><br><span class="line">ETCD_NAME=<span class="string">&quot;controller&quot;</span>  </span><br><span class="line"><span class="comment">#[Clustering]</span></span><br><span class="line">ETCD_INITIAL_ADVERTISE_PEER_URLS=<span class="string">&quot;http://172.16.80.11:2380&quot;</span></span><br><span class="line">ETCD_ADVERTISE_CLIENT_URLS=<span class="string">&quot;http://172.16.80.11:2379&quot;</span></span><br><span class="line">ETCD_INITIAL_CLUSTER=<span class="string">&quot;controller=http://172.16.80.11:2380&quot;</span>   <span class="comment">#将default改为上面的ETCD_NAME</span></span><br><span class="line">ETCD_INITIAL_CLUSTER_TOKEN=<span class="string">&quot;etcd-cluster-01&quot;</span></span><br><span class="line">ETCD_INITIAL_CLUSTER_STATE=<span class="string">&quot;new&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#启动etcd服务并设为开机启动：</span></span><br><span class="line">systemctl <span class="built_in">enable</span> etcd &amp;&amp; systemctl start etcd</span><br></pre></td></tr></table></figure>



<h3 id="3-安装OpenStack服务"><a href="#3-安装OpenStack服务" class="headerlink" title="3 安装OpenStack服务"></a>3 安装OpenStack服务</h3><h4 id="3-1-安装keystone服务"><a href="#3-1-安装keystone服务" class="headerlink" title="3.1 安装keystone服务"></a>3.1 安装keystone服务</h4><blockquote>
<p>controller</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#安装和配置keystone</span></span><br><span class="line">mysql -u root -p123456</span><br><span class="line">CREATE DATABASE keystone;</span><br><span class="line">GRANT ALL PRIVILEGES ON keystone.* TO <span class="string">&#x27;keystone&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> IDENTIFIED BY <span class="string">&#x27;123456&#x27;</span>;</span><br><span class="line">GRANT ALL PRIVILEGES ON keystone.* TO <span class="string">&#x27;keystone&#x27;</span>@<span class="string">&#x27;%&#x27;</span> IDENTIFIED BY <span class="string">&#x27;123456&#x27;</span>;</span><br><span class="line">flush privileges;</span><br><span class="line"><span class="built_in">exit</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#安装和配置keystone组件</span></span><br><span class="line">yum install openstack-keystone httpd mod_wsgi -y</span><br><span class="line"></span><br><span class="line"><span class="comment">#利用命令添加配置</span></span><br><span class="line">crudini --<span class="built_in">set</span> /etc/keystone/keystone.conf database connection mysql+pymysql://keystone:123456@controller/keystone</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/keystone/keystone.conf token provider fernet</span><br><span class="line"></span><br><span class="line"><span class="comment">#同步认证服务数据库：</span></span><br><span class="line">su -s /bin/sh -c <span class="string">&quot;keystone-manage db_sync&quot;</span> keystone</span><br><span class="line"></span><br><span class="line"><span class="comment">#验证是否同步：</span></span><br><span class="line">mysql -uroot -p123456 -e <span class="string">&quot;use keystone;show tables;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#初始化密钥存储库 Fernet key库：</span></span><br><span class="line">keystone-manage fernet_setup --keystone-user keystone --keystone-group keystone</span><br><span class="line">keystone-manage credential_setup --keystone-user keystone --keystone-group keystone</span><br><span class="line"></span><br><span class="line"><span class="comment">#引导身份认证服务： 替换ADMIN_PASS为管理用户的合适密码，这里为123456</span></span><br><span class="line">keystone-manage bootstrap --bootstrap-password 123456 \</span><br><span class="line">--bootstrap-admin-url http://controller:5000/v3/ \</span><br><span class="line">--bootstrap-internal-url http://controller:5000/v3/ \</span><br><span class="line">--bootstrap-public-url http://controller:5000/v3/ \</span><br><span class="line">--bootstrap-region-id RegionOne</span><br><span class="line"></span><br><span class="line"><span class="comment">#配置apache http服务</span></span><br><span class="line"><span class="comment">#编辑/etc/httpd/conf/httpd.conf文件并配置ServerName选项以引用控制节点：</span></span><br><span class="line">vim /etc/httpd/conf/httpd.conf</span><br><span class="line">ServerName controller</span><br><span class="line"><span class="comment">#创建到/usr/share/keystone/wsgi-keystone.conf文件的链接：</span></span><br><span class="line"><span class="built_in">ln</span> -s /usr/share/keystone/wsgi-keystone.conf /etc/httpd/conf.d/</span><br><span class="line"><span class="comment">#启动Apache HTTP服务并配置开机启动</span></span><br><span class="line">systemctl <span class="built_in">enable</span> httpd &amp;&amp; systemctl start httpd</span><br><span class="line"><span class="comment">#配置administrative 账户</span></span><br><span class="line"><span class="comment">#创建并编辑admin-openrc文件并添加以下内容：</span></span><br><span class="line"><span class="built_in">cat</span> &gt; admin-openrc &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">export OS_PROJECT_DOMAIN_NAME=Default</span></span><br><span class="line"><span class="string">export OS_USER_DOMAIN_NAME=Default</span></span><br><span class="line"><span class="string">export OS_PROJECT_NAME=admin</span></span><br><span class="line"><span class="string">export OS_USERNAME=admin</span></span><br><span class="line"><span class="string">export OS_PASSWORD=123456</span></span><br><span class="line"><span class="string">export OS_AUTH_URL=http://controller:5000/v3</span></span><br><span class="line"><span class="string">export OS_IDENTITY_API_VERSION=3</span></span><br><span class="line"><span class="string">export OS_IMAGE_API_VERSION=2</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"><span class="comment">#创建并编辑demo-openrc文件并添加以下内容：</span></span><br><span class="line"><span class="built_in">cat</span> &gt; demo-openrc &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">export OS_PROJECT_DOMAIN_NAME=default</span></span><br><span class="line"><span class="string">export OS_USER_DOMAIN_NAME=default</span></span><br><span class="line"><span class="string">export OS_PROJECT_NAME=demo</span></span><br><span class="line"><span class="string">export OS_USERNAME=demo</span></span><br><span class="line"><span class="string">export OS_PASSWORD=123456</span></span><br><span class="line"><span class="string">export OS_AUTH_URL=http://controller:5000/v3</span></span><br><span class="line"><span class="string">export OS_IDENTITY_API_VERSION=3</span></span><br><span class="line"><span class="string">export OS_IMAGE_API_VERSION=2</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">source</span> admin-openrc</span><br><span class="line"></span><br><span class="line"><span class="comment">#创建项目和用户</span></span><br><span class="line"><span class="comment">#创建demo域，不创建也行，默认存在default域，admin项目和admin用户和角色 ...看清楚，不需要创建</span></span><br><span class="line">openstack domain create --description <span class="string">&quot;An Example Domain&quot;</span> demo</span><br><span class="line"><span class="comment">#创建service项目，供nova，glance等组件使用</span></span><br><span class="line">openstack project create --domain default --description <span class="string">&quot;Service Project&quot;</span> service</span><br><span class="line"><span class="comment">#创建demo项目</span></span><br><span class="line">openstack project create --domain default --description <span class="string">&quot;Demo Project&quot;</span> demo</span><br><span class="line"><span class="comment">#创建demo用户</span></span><br><span class="line">openstack user create --domain default --password-prompt demo <span class="comment">#密码为123456</span></span><br><span class="line"><span class="comment">#创建user角色</span></span><br><span class="line">openstack role create user</span><br><span class="line"><span class="comment">#将demo用户和角色添加到demo项目</span></span><br><span class="line">openstack role add --project demo --user demo user</span><br><span class="line"></span><br><span class="line"><span class="comment">#验证认证服务操作</span></span><br><span class="line"><span class="built_in">unset</span> OS_AUTH_URL OS_PASSWORD</span><br><span class="line"><span class="comment">#作为管理员用户，请求身份验证令牌</span></span><br><span class="line">openstack --os-auth-url http://controller:5000/v3 --os-project-domain-name Default --os-user-domain-name Default --os-project-name admin --os-username admin token issue</span><br><span class="line"><span class="comment">#作为myuser用户，请求身份验证令牌：</span></span><br><span class="line">openstack --os-auth-url http://controller:5000/v3 --os-project-domain-name Default --os-user-domain-name Default --os-project-name demo --os-username demo token issue</span><br><span class="line"></span><br><span class="line"><span class="comment">#使用环境脚本</span></span><br><span class="line"><span class="comment">#1.加载admin-openrc文件以使用Identity服务的位置以及管理项目和用户凭据执行环境变量：</span></span><br><span class="line"><span class="comment">#2.请求身份验证令牌：</span></span><br><span class="line"><span class="comment">#验证admin</span></span><br><span class="line"><span class="built_in">source</span> admin-openrc</span><br><span class="line">openstack token issue  <span class="comment">#获取token</span></span><br><span class="line"><span class="comment">#验证demo</span></span><br><span class="line"><span class="built_in">source</span> demo-openrc</span><br><span class="line">openstack token issue</span><br></pre></td></tr></table></figure>

<h4 id="3-2-安装Glance服务"><a href="#3-2-安装Glance服务" class="headerlink" title="3.2 安装Glance服务"></a>3.2 安装Glance服务</h4><blockquote>
<p>controller</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#创建glance数据库</span></span><br><span class="line">mysql -u root -p123456</span><br><span class="line">CREATE DATABASE glance;</span><br><span class="line">GRANT ALL PRIVILEGES ON glance.* TO <span class="string">&#x27;glance&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> IDENTIFIED BY <span class="string">&#x27;123456&#x27;</span>;</span><br><span class="line">GRANT ALL PRIVILEGES ON glance.* TO <span class="string">&#x27;glance&#x27;</span>@<span class="string">&#x27;%&#x27;</span> IDENTIFIED BY <span class="string">&#x27;123456&#x27;</span>;</span><br><span class="line">flush privileges;</span><br><span class="line"><span class="built_in">exit</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">source</span> admin-openrc</span><br><span class="line"><span class="comment">#要创建服务凭据</span></span><br><span class="line"><span class="comment">#创建glance用户</span></span><br><span class="line">openstack user create --domain default --password 123456 glance</span><br><span class="line"><span class="comment">#把admin角色添加到glance用户和项目中</span></span><br><span class="line">openstack role add --project service --user glance admin</span><br><span class="line"><span class="comment">#创建glance服务实体</span></span><br><span class="line">openstack service create --name glance --description <span class="string">&quot;OpenStack Image&quot;</span> image</span><br><span class="line"><span class="comment">#创建镜像服务API端点</span></span><br><span class="line">openstack endpoint create --region RegionOne image public http://controller:9292</span><br><span class="line">openstack endpoint create --region RegionOne image internal http://controller:9292</span><br><span class="line">openstack endpoint create --region RegionOne image admin http://controller:9292</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#安装和配置组件</span></span><br><span class="line">yum install openstack-glance -y</span><br><span class="line"></span><br><span class="line"><span class="comment">#/etc/glance/glance-api.conf</span></span><br><span class="line">crudini --<span class="built_in">set</span> /etc/glance/glance-api.conf database connection mysql+pymysql://glance:123456@controller/glance</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/glance/glance-api.conf keystone_authtoken auth_uri http://controller:5000</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/glance/glance-api.conf keystone_authtoken auth_url http://controller:5000</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/glance/glance-api.conf keystone_authtoken memcached_servers controller:11211</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/glance/glance-api.conf keystone_authtoken auth_type password</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/glance/glance-api.conf keystone_authtoken project_domain_name default</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/glance/glance-api.conf keystone_authtoken user_domain_name default</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/glance/glance-api.conf keystone_authtoken project_name service</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/glance/glance-api.conf keystone_authtoken username glance</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/glance/glance-api.conf keystone_authtoken password 123456</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/glance/glance-api.conf paste_deploy flavor keystone</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/glance/glance-api.conf glance_store stores file,http</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/glance/glance-api.conf glance_store default_store file</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/glance/glance-api.conf glance_store filesystem_store_datadir /var/lib/glance/images/</span><br><span class="line"></span><br><span class="line"><span class="comment">#/etc/glance/glance-registry.conf</span></span><br><span class="line">crudini --<span class="built_in">set</span> /etc/glance/glance-registry.conf database connection mysql+pymysql://glance:123456@controller/glance</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/glance/glance-registry.conf keystone_authtoken auth_uri http://controller:5000</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/glance/glance-registry.conf keystone_authtoken auth_url http://controller:5000</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/glance/glance-registry.conf keystone_authtoken memcached_servers controller:11211</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/glance/glance-registry.conf keystone_authtoken auth_type password</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/glance/glance-registry.conf keystone_authtoken project_domain_name default</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/glance/glance-registry.conf keystone_authtoken user_domain_name default</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/glance/glance-registry.conf keystone_authtoken project_name service</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/glance/glance-registry.conf keystone_authtoken username glance</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/glance/glance-registry.conf keystone_authtoken password 123456</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/glance/glance-registry.conf paste_deploy flavor keystone</span><br><span class="line"></span><br><span class="line"><span class="comment">#同步镜像服务数据库</span></span><br><span class="line"> su -s /bin/sh -c <span class="string">&quot;glance-manage db_sync&quot;</span> glance</span><br><span class="line"></span><br><span class="line"><span class="comment">#完成安装,启动镜像服务并设为开机启动：</span></span><br><span class="line">systemctl <span class="built_in">enable</span> openstack-glance-api.service openstack-glance-registry.service &amp;&amp; systemctl restart openstack-glance-api.service openstack-glance-registry.service</span><br><span class="line"></span><br><span class="line"><span class="comment">#验证操作</span></span><br><span class="line">egrep -v <span class="string">&quot;^#|^$&quot;</span> /etc/glance/glance-api.conf</span><br><span class="line">egrep -v <span class="string">&quot;^#|^$&quot;</span> /etc/glance/glance-registry.conf</span><br><span class="line"></span><br><span class="line"><span class="comment">#下载镜像</span></span><br><span class="line">wget http://download.cirros-cloud.net/0.4.0/cirros-0.4.0-x86_64-disk.img</span><br><span class="line"><span class="comment">#将镜像上传到image服务，指定磁盘格式为QCOW2，指定裸容器格式和公开可见性，以便所有项目都可以访问它：</span></span><br><span class="line"><span class="built_in">source</span> admin-openrc</span><br><span class="line">openstack image create <span class="string">&quot;cirros&quot;</span> \</span><br><span class="line">--file cirros-0.4.0-x86_64-disk.img \</span><br><span class="line">--disk-format qcow2 \</span><br><span class="line">--container-format bare \</span><br><span class="line">--public</span><br><span class="line"><span class="comment">#或</span></span><br><span class="line"><span class="built_in">source</span> admin-openrc</span><br><span class="line">glance image-create --name <span class="string">&quot;cirros&quot;</span> \</span><br><span class="line">  --file cirros-0.4.0-x86_64-disk.img \</span><br><span class="line">  --disk-format qcow2 --container-format bare \</span><br><span class="line">  --visibility public</span><br><span class="line"><span class="comment">#查看上传的镜像，镜像状态应为active状态</span></span><br><span class="line">openstack image list </span><br></pre></td></tr></table></figure>

<h4 id="3-3-安装nova-placement服务"><a href="#3-3-安装nova-placement服务" class="headerlink" title="3.3 安装nova placement服务"></a>3.3 安装nova placement服务</h4><blockquote>
<p> controller</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">##安装和配置控制节点</span></span><br><span class="line">mysql -u root -p123456</span><br><span class="line"><span class="comment">#创建nova_api, nova, nova_cell0数据库</span></span><br><span class="line">CREATE DATABASE nova_api;</span><br><span class="line">CREATE DATABASE nova;</span><br><span class="line">CREATE DATABASE nova_cell0;</span><br><span class="line">GRANT ALL PRIVILEGES ON nova_api.* TO <span class="string">&#x27;nova&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> IDENTIFIED BY <span class="string">&#x27;123456&#x27;</span>;</span><br><span class="line">GRANT ALL PRIVILEGES ON nova_api.* TO <span class="string">&#x27;nova&#x27;</span>@<span class="string">&#x27;%&#x27;</span> IDENTIFIED BY <span class="string">&#x27;123456&#x27;</span>;</span><br><span class="line">GRANT ALL PRIVILEGES ON nova.* TO <span class="string">&#x27;nova&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> IDENTIFIED BY <span class="string">&#x27;123456&#x27;</span>;</span><br><span class="line">GRANT ALL PRIVILEGES ON nova.* TO <span class="string">&#x27;nova&#x27;</span>@<span class="string">&#x27;%&#x27;</span> IDENTIFIED BY <span class="string">&#x27;123456&#x27;</span>;</span><br><span class="line">GRANT ALL PRIVILEGES ON nova_cell0.* TO <span class="string">&#x27;nova&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> IDENTIFIED BY <span class="string">&#x27;123456&#x27;</span>;</span><br><span class="line">GRANT ALL PRIVILEGES ON nova_cell0.* TO <span class="string">&#x27;nova&#x27;</span>@<span class="string">&#x27;%&#x27;</span> IDENTIFIED BY <span class="string">&#x27;123456&#x27;</span>;</span><br><span class="line"></span><br><span class="line">CREATE DATABASE placement;</span><br><span class="line">GRANT ALL PRIVILEGES ON placement.* TO <span class="string">&#x27;placement&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> IDENTIFIED BY <span class="string">&#x27;123456&#x27;</span>;</span><br><span class="line">GRANT ALL PRIVILEGES ON placement.* TO <span class="string">&#x27;placement&#x27;</span>@<span class="string">&#x27;%&#x27;</span> IDENTIFIED BY <span class="string">&#x27;123456&#x27;</span>;</span><br><span class="line">flush privileges;</span><br><span class="line"><span class="built_in">exit</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">source</span> admin-openrc</span><br><span class="line"><span class="comment">#创建计算服务凭证</span></span><br><span class="line"><span class="comment">#创建nova用户</span></span><br><span class="line">openstack user create --domain default --password 123456 nova</span><br><span class="line"><span class="comment">#为nova用户添加admin角色</span></span><br><span class="line">openstack role add --project service --user nova admin</span><br><span class="line"><span class="comment">#创建nova服务端点</span></span><br><span class="line">openstack service create --name nova --description <span class="string">&quot;OpenStack Compute&quot;</span> compute</span><br><span class="line"><span class="comment">#创建compute API 服务端点</span></span><br><span class="line">openstack endpoint create --region RegionOne compute public http://controller:8774/v2.1</span><br><span class="line">openstack endpoint create --region RegionOne compute internal http://controller:8774/v2.1</span><br><span class="line">openstack endpoint create --region RegionOne compute admin http://controller:8774/v2.1</span><br><span class="line"></span><br><span class="line"><span class="comment">#创建一个placement用户</span></span><br><span class="line">openstack user create --domain default --password 123456 placement </span><br><span class="line"><span class="comment">#将placement用户添加到admin角色和service项目中</span></span><br><span class="line">openstack role add --project service --user placement admin </span><br><span class="line">openstack service create --name placement --description <span class="string">&quot;Placement API&quot;</span> placement <span class="comment">#创建API条目</span></span><br><span class="line">openstack endpoint create --region RegionOne placement public http://controller:8778  <span class="comment">#创建API端点</span></span><br><span class="line">openstack endpoint create --region RegionOne placement internal http://controller:8778</span><br><span class="line">openstack endpoint create --region RegionOne placement admin http://controller:8778</span><br><span class="line"></span><br><span class="line"><span class="comment">##安装和配置组件</span></span><br><span class="line">yum install openstack-nova-api openstack-nova-conductor openstack-nova-console openstack-nova-novncproxy openstack-nova-scheduler openstack-placement-api -y</span><br><span class="line"></span><br><span class="line"><span class="comment">#/etc/nova/nova.conf</span></span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf DEFAULT enabled_apis osapi_compute,metadata</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf DEFAULT transport_url rabbit://openstack:123456@controller</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf DEFAULT my_ip 172.16.80.11</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf DEFAULT use_neutron True</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf DEFAULT firewall_driver nova.virt.firewall.NoopFirewallDriver</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf api_database connection mysql+pymysql://nova:123456@controller/nova_api</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf database connection mysql+pymysql://nova:123456@controller/nova</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf api auth_strategy keystone</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf keystone_authtoken auth_uri http://controller:5000</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf keystone_authtoken auth_url http://controller:5000</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf keystone_authtoken memcached_servers controller:11211</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf keystone_authtoken auth_type password</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf keystone_authtoken project_domain_name default</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf keystone_authtoken user_domain_name default</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf keystone_authtoken project_name service</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf keystone_authtoken username nova</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf keystone_authtoken password 123456</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf vnc enabled <span class="literal">true</span></span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf vnc server_listen 172.16.80.11</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf vnc server_proxyclient_address 172.16.80.11</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf glance api_servers http://controller:9292</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf oslo_concurrency lock_path /var/lib/nova/tmp</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf placement region_name RegionOne</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf placement project_domain_name default</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf placement project_name service</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf placement auth_type password</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf placement user_domain_name default</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf placement auth_url http://controller:5000/v3</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf placement username placement</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf placement password 123456</span><br><span class="line"></span><br><span class="line"><span class="comment">#vim /etc/placement/placement.conf</span></span><br><span class="line">crudini --<span class="built_in">set</span> /etc/placement/placement.conf placement_database connection mysql+pymysql://placement:123456@controller/placement</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/placement/placement.conf api auth_strategy keystone</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/placement/placement.conf keystone_authtoken auth_url http://controller:5000/v3</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/placement/placement.conf keystone_authtoken memcached_servers controller:11211</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/placement/placement.conf keystone_authtoken auth_type password</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/placement/placement.conf keystone_authtoken project_domain_name default</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/placement/placement.conf keystone_authtoken user_domain_name default</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/placement/placement.conf keystone_authtoken project_name service</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/placement/placement.conf keystone_authtoken username placement</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/placement/placement.conf keystone_authtoken password 123456</span><br><span class="line"></span><br><span class="line"><span class="comment">#因为软件包的bug，要修改配置文件添加以下内容</span></span><br><span class="line">vim /etc/httpd/conf.d/00-placement-api.conf</span><br><span class="line"><span class="comment">#在ErrorLog /var/log/placement/placement-api.log后添加如下</span></span><br><span class="line">&lt;Directory /usr/bin&gt;</span><br><span class="line">   &lt;IfVersion &gt;= 2.4&gt;</span><br><span class="line">      Require all granted</span><br><span class="line">   &lt;/IfVersion&gt;</span><br><span class="line">   &lt;IfVersion &lt; 2.4&gt;</span><br><span class="line">      Order allow,deny</span><br><span class="line">      Allow from all</span><br><span class="line">   &lt;/IfVersion&gt;</span><br><span class="line">&lt;/Directory&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">#重启httpd服务</span></span><br><span class="line">systemctl restart httpd</span><br><span class="line"></span><br><span class="line">su -s /bin/sh -c <span class="string">&quot;nova-manage api_db sync&quot;</span> nova</span><br><span class="line">su -s /bin/sh -c <span class="string">&quot;nova-manage cell_v2 map_cell0&quot;</span> nova <span class="comment">#注册cell0数据库</span></span><br><span class="line">su -s /bin/sh -c <span class="string">&quot;nova-manage cell_v2 create_cell --name=cell1 --verbose&quot;</span> nova</span><br><span class="line">su -s /bin/sh -c <span class="string">&quot;nova-manage db sync&quot;</span> nova</span><br><span class="line">su -s /bin/sh -c <span class="string">&quot;nova-manage cell_v2 list_cells&quot;</span> nova</span><br><span class="line"></span><br><span class="line">su -s /bin/sh -c <span class="string">&quot;placement-manage db sync&quot;</span> placement <span class="comment">#写入数据库</span></span><br><span class="line"><span class="comment">#/usr/lib/python2.7/site-packages/pymysql/cursors.py:170: Warning: (1280, u&quot;Name &#x27;alembic_version_pkc&#x27; ignored for PRIMARY key.&quot;)</span></span><br><span class="line">  result = self._query(query)</span><br><span class="line"><span class="comment">#以上为正常现象</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#验证是否注册成功</span></span><br><span class="line">nova-manage cell_v2 list_cells</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#启动nova服务并设置开机自启</span></span><br><span class="line">systemctl <span class="built_in">enable</span> openstack-nova-api.service  openstack-nova-console.service openstack-nova-scheduler.service openstack-nova-conductor.service openstack-nova-novncproxy.service</span><br><span class="line">systemctl start openstack-nova-api.service openstack-nova-console.service openstack-nova-scheduler.service openstack-nova-conductor.service openstack-nova-novncproxy.service</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>compute</strong>     易错警告⚠</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#安装和配置计算节点</span></span><br><span class="line"><span class="comment">#安装和配置组件</span></span><br><span class="line">yum install openstack-nova-compute crudini -y</span><br><span class="line"></span><br><span class="line"><span class="comment">#/etc/nova/nova.conf</span></span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf DEFAULT enabled_apis osapi_compute,metadata</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf DEFAULT transport_url rabbit://openstack:123456@controller</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf DEFAULT my_ip 172.16.80.12</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf DEFAULT use_neutron True</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf DEFAULT firewall_driver nova.virt.firewall.NoopFirewallDriver</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf api auth_strategy keystone</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf keystone_authtoken www_authenticate_uri http://controller:5000</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf keystone_authtoken auth_url http://controller:5000</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf keystone_authtoken memcached_servers controller:11211</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf keystone_authtoken auth_type password</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf keystone_authtoken project_domain_name default</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf keystone_authtoken user_domain_name default</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf keystone_authtoken project_name service</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf keystone_authtoken username nova</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf keystone_authtoken password 123456</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf vnc enabled True</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf vnc server_listen 0.0.0.0</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf vnc server_proxyclient_address 172.16.80.12</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf vnc novncproxy_base_url http://controller:6080/vnc_auto.html</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf glance api_servers http://controller:9292</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf oslo_concurrency lock_path /var/lib/nova/tmp</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf placement os_region_name RegionOne</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf placement project_domain_name Default</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf placement project_name service</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf placement auth_type password</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf placement user_domain_name default</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf placement auth_url http://controller:5000/v3</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf placement username placement</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf placement password 123456</span><br><span class="line"></span><br><span class="line"><span class="comment">#[真实服务器]</span></span><br><span class="line"><span class="comment">#egrep -c &#x27;(vmx|svm)&#x27; /proc/cpuinfo //如果此命令返回值为one or greater，您的计算节点支持硬件加速，这通常不需要额外的配置。如果此命令返回值为zero，您的计算节点不支持硬件加速，您必须配置libvirt使用QEMU而不是KVM）</span></span><br><span class="line">vim /etc/nova/nova.conf</span><br><span class="line">[libvirt]</span><br><span class="line">virt_type = qemu</span><br><span class="line"><span class="comment">#或</span></span><br><span class="line"><span class="comment">#判断计算节点是否支持虚拟机的硬件加速</span></span><br><span class="line">virt_num=`egrep -c <span class="string">&#x27;(vmx|svm)&#x27;</span> /proc/cpuinfo`</span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$virt_num</span> = <span class="string">&#x27;0&#x27;</span> ];<span class="keyword">then</span></span><br><span class="line">	crudini --<span class="built_in">set</span> /etc/nova/nova.conf libvirt virt_type  qemu</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#[vm]</span></span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf libvirt virt_type  qemu</span><br><span class="line"></span><br><span class="line"><span class="comment">#启动计算服务（包括其相关性），并将其配置为在系统引导时自动启动：</span></span><br><span class="line">systemctl <span class="built_in">enable</span> libvirtd.service openstack-nova-compute.service</span><br><span class="line">systemctl restart libvirtd.service openstack-nova-compute.service</span><br></pre></td></tr></table></figure>

<blockquote>
<p>controller</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#添加compute节点到cell数据库</span></span><br><span class="line"><span class="built_in">source</span> admin-openrc</span><br><span class="line">openstack compute service list --service nova-compute</span><br><span class="line"></span><br><span class="line"><span class="comment">#发现计算节点</span></span><br><span class="line">su -s /bin/sh -c <span class="string">&quot;nova-manage cell_v2 discover_hosts --verbose&quot;</span> nova</span><br><span class="line"></span><br><span class="line"><span class="comment">#验证计算服务操作</span></span><br><span class="line"><span class="comment">#1.列出服务组件以验证每个进程成功启动和注册：</span></span><br><span class="line"><span class="built_in">source</span> admin-openrc</span><br><span class="line">openstack compute service list <span class="comment">#此输出应显示在控制节点上启用三个服务组件，并在计算节点上启用一个服务组件。</span></span><br><span class="line"><span class="comment">#2.列出身份服务中的API端点以验证与身份服务的连接：</span></span><br><span class="line">openstack catalog list</span><br><span class="line"><span class="comment">#3.列出Image服务中的镜像以验证与Image服务的连通性：</span></span><br><span class="line">openstack image list</span><br><span class="line"><span class="comment">#4.检查cells和placement API是否正常运行</span></span><br><span class="line">nova-status upgrade check</span><br></pre></td></tr></table></figure>

<h4 id="3-4-安装neutron服务"><a href="#3-4-安装neutron服务" class="headerlink" title="3.4 安装neutron服务"></a>3.4 安装neutron服务</h4><blockquote>
<p>controller</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#创建数据库</span></span><br><span class="line">mysql -u root -p123456</span><br><span class="line">CREATE DATABASE neutron;</span><br><span class="line">GRANT ALL PRIVILEGES ON neutron.* TO <span class="string">&#x27;neutron&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> IDENTIFIED BY <span class="string">&#x27;123456&#x27;</span>;</span><br><span class="line">GRANT ALL PRIVILEGES ON neutron.* TO <span class="string">&#x27;neutron&#x27;</span>@<span class="string">&#x27;%&#x27;</span> IDENTIFIED BY <span class="string">&#x27;123456&#x27;</span>;</span><br><span class="line">flush privileges;</span><br><span class="line"><span class="built_in">exit</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">source</span> admin-openrc</span><br><span class="line"><span class="comment">#创建服务凭证，完成以下操作</span></span><br><span class="line"><span class="comment">#创建neutron用户</span></span><br><span class="line">openstack user create --domain default --password 123456 neutron</span><br><span class="line"><span class="comment">#添加admin角色到neutron用户</span></span><br><span class="line">openstack role add --project service --user neutron admin</span><br><span class="line"><span class="comment">#创建neutron服务实体</span></span><br><span class="line">openstack service create --name neutron --description <span class="string">&quot;OpenStack Networking&quot;</span> network</span><br><span class="line"><span class="comment">#创建网络服务API端点</span></span><br><span class="line">openstack endpoint create --region RegionOne network public http://controller:9696</span><br><span class="line">openstack endpoint create --region RegionOne network internal http://controller:9696</span><br><span class="line">openstack endpoint create --region RegionOne network admin http://controller:9696</span><br><span class="line"></span><br><span class="line"><span class="comment">#配置网络部分</span></span><br><span class="line"><span class="comment">#安装组件</span></span><br><span class="line">yum install openstack-neutron openstack-neutron-ml2 openstack-neutron-linuxbridge ebtables -y</span><br><span class="line"></span><br><span class="line"><span class="comment">#配置服务组件</span></span><br><span class="line"><span class="comment">#/etc/neutron/neutron.conf</span></span><br><span class="line">crudini --<span class="built_in">set</span> /etc/neutron/neutron.conf DEFAULT core_plugin ml2</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/neutron/neutron.conf DEFAULT service_plugins router</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/neutron/neutron.conf DEFAULT allow_overlapping_ips <span class="literal">true</span></span><br><span class="line">crudini --<span class="built_in">set</span> /etc/neutron/neutron.conf DEFAULT transport_url rabbit://openstack:123456@controller</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/neutron/neutron.conf DEFAULT auth_strategy keystone</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/neutron/neutron.conf DEFAULT notify_nova_on_port_status_changes <span class="literal">true</span></span><br><span class="line">crudini --<span class="built_in">set</span> /etc/neutron/neutron.conf DEFAULT notify_nova_on_port_data_changes <span class="literal">true</span></span><br><span class="line">crudini --<span class="built_in">set</span> /etc/neutron/neutron.conf database connection mysql+pymysql://neutron:123456@controller/neutron</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/neutron/neutron.conf keystone_authtoken auth_uri http://controller:5000</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/neutron/neutron.conf keystone_authtoken auth_url http://controller:5000</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/neutron/neutron.conf keystone_authtoken memcached_servers controller:11211</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/neutron/neutron.conf keystone_authtoken auth_type password</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/neutron/neutron.conf keystone_authtoken project_domain_name default</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/neutron/neutron.conf keystone_authtoken user_domain_name default</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/neutron/neutron.conf keystone_authtoken project_name service</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/neutron/neutron.conf keystone_authtoken username neutron</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/neutron/neutron.conf keystone_authtoken password 123456</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/neutron/neutron.conf nova auth_url http://controller:5000</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/neutron/neutron.conf nova auth_type password</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/neutron/neutron.conf nova project_domain_name default</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/neutron/neutron.conf nova user_domain_name default</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/neutron/neutron.conf nova region_name RegionOne</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/neutron/neutron.conf nova project_name service</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/neutron/neutron.conf nova username nova</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/neutron/neutron.conf nova password 123456</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/neutron/neutron.conf oslo_concurrency lock_path /var/lib/neutron/tmp</span><br><span class="line"></span><br><span class="line"><span class="comment">#配置网络二层插件</span></span><br><span class="line"><span class="comment">#/etc/neutron/plugins/ml2/ml2_conf.ini</span></span><br><span class="line">crudini --<span class="built_in">set</span> /etc/neutron/plugins/ml2/ml2_conf.ini ml2 type_drivers flat,vlan,vxlan</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/neutron/plugins/ml2/ml2_conf.ini ml2 tenant_network_types vxlan</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/neutron/plugins/ml2/ml2_conf.ini ml2 mechanism_drivers linuxbridge,l2population</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/neutron/plugins/ml2/ml2_conf.ini ml2 extension_drivers port_security</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/neutron/plugins/ml2/ml2_conf.ini ml2_type_flat flat_networks provider</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/neutron/plugins/ml2/ml2_conf.ini ml2_type_vxlan vni_ranges 1:1000</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/neutron/plugins/ml2/ml2_conf.ini securitygroup enable_ipset <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#配置linux网桥代理 </span></span><br><span class="line"><span class="comment">#/etc/neutron/plugins/ml2/linuxbridge_agent.ini</span></span><br><span class="line">crudini --<span class="built_in">set</span> /etc/neutron/plugins/ml2/linuxbridge_agent.ini linux_bridge physical_interface_mappings provider:ens33</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/neutron/plugins/ml2/linuxbridge_agent.ini vxlan enable_vxlan <span class="literal">true</span></span><br><span class="line">crudini --<span class="built_in">set</span> /etc/neutron/plugins/ml2/linuxbridge_agent.ini vxlan local_ip 172.16.80.11</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/neutron/plugins/ml2/linuxbridge_agent.ini vxlan l2_population <span class="literal">true</span></span><br><span class="line">crudini --<span class="built_in">set</span> /etc/neutron/plugins/ml2/linuxbridge_agent.ini securitygroup enable_security_group <span class="literal">true</span></span><br><span class="line">crudini --<span class="built_in">set</span> /etc/neutron/plugins/ml2/linuxbridge_agent.ini securitygroup firewall_driver neutron.agent.linux.iptables_firewall.IptablesFirewallDriver</span><br><span class="line"></span><br><span class="line"><span class="comment">#通过验证下列所有SysTL值设置为1以确保Linux操作系统内核支持网桥过滤器：</span></span><br><span class="line">vim /usr/lib/sysctl.d/00-system.conf </span><br><span class="line">net.bridge.bridge-nf-call-iptables=1</span><br><span class="line">net.bridge.bridge-nf-call-ip6tables=1</span><br><span class="line">sysctl -p</span><br><span class="line"></span><br><span class="line"><span class="comment">#配置三层代理</span></span><br><span class="line"><span class="comment">#Layer-3（L3）代理为自助虚拟网络提供路由和NAT服务。</span></span><br><span class="line"><span class="comment">#/etc/neutron/l3_agent.ini</span></span><br><span class="line">crudini --<span class="built_in">set</span> /etc/neutron/l3_agent.ini DEFAULT interface_driver linuxbridge</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#配置DHCP代理</span></span><br><span class="line"><span class="comment">#/etc/neutron/dhcp_agent.ini</span></span><br><span class="line">crudini --<span class="built_in">set</span> /etc/neutron/dhcp_agent.ini DEFAULT interface_driver linuxbridge</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/neutron/dhcp_agent.ini DEFAULT dhcp_driver neutron.agent.linux.dhcp.Dnsmasq</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/neutron/dhcp_agent.ini DEFAULT enable_isolated_metadata <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#配置metadata</span></span><br><span class="line"><span class="comment">#/etc/neutron/metadata_agent.ini</span></span><br><span class="line">crudini --<span class="built_in">set</span> /etc/neutron/metadata_agent.ini DEFAULT nova_metadata_host controller</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/neutron/metadata_agent.ini DEFAULT metadata_proxy_shared_secret 123456</span><br><span class="line"></span><br><span class="line"><span class="comment">#配置计算服务使用网络服务</span></span><br><span class="line"><span class="comment">#/etc/nova/nova.conf </span></span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf  neutron auth_url http://controller:5000</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf  neutron auth_type password</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf  neutron project_domain_name default</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf  neutron user_domain_name default</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf  neutron region_name RegionOne</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf  neutron project_name service</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf  neutron username neutron</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf  neutron password 123456</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf  neutron service_metadata_proxy <span class="literal">true</span></span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf  neutron metadata_proxy_shared_secret 123456</span><br><span class="line"></span><br><span class="line"><span class="comment">#完成安装启动服务</span></span><br><span class="line"><span class="comment">#网络服务初始化脚本需要一个指向ML2插件配置文件/etc/neutron/plugins/ml2/ml2_conf.ini的符号链接/etc/neutron/plugin.ini。 如果此符号链接不存在，请使用以下命令创建它：</span></span><br><span class="line"><span class="built_in">ln</span> -s /etc/neutron/plugins/ml2/ml2_conf.ini /etc/neutron/plugin.ini</span><br><span class="line"><span class="comment">#重启compute API服务</span></span><br><span class="line">systemctl restart openstack-nova-api</span><br><span class="line"><span class="comment">#同步数据库</span></span><br><span class="line">su -s /bin/sh -c <span class="string">&quot;neutron-db-manage --config-file /etc/neutron/neutron.conf   --config-file /etc/neutron/plugins/ml2/ml2_conf.ini upgrade head&quot;</span> neutron</span><br><span class="line"></span><br><span class="line"><span class="comment">#启动网络服务并设为开机启动</span></span><br><span class="line">systemctl <span class="built_in">enable</span> neutron-server.service neutron-linuxbridge-agent.service neutron-dhcp-agent.service neutron-metadata-agent.service</span><br><span class="line">systemctl start neutron-server.service neutron-linuxbridge-agent.service neutron-dhcp-agent.service neutron-metadata-agent.service</span><br><span class="line">systemctl status neutron-server.service neutron-linuxbridge-agent.service neutron-dhcp-agent.service neutron-metadata-agent.service</span><br><span class="line"><span class="comment">#对于联网选项2，还启用并启动第三层服务：</span></span><br><span class="line">systemctl <span class="built_in">enable</span> neutron-l3-agent.service &amp;&amp; systemctl start neutron-l3-agent.service</span><br></pre></td></tr></table></figure>

<blockquote>
<p>安装和配置<strong>compute</strong>节点  <strong>易错警告</strong>⚠</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#计算节点处理实例的连接和安全组。</span></span><br><span class="line"><span class="comment">#安装和配置组件</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#安装组件</span></span><br><span class="line">yum install openstack-neutron-linuxbridge ebtables ipset -y</span><br><span class="line"></span><br><span class="line"><span class="comment">#配置公共组件</span></span><br><span class="line"><span class="comment">#/etc/neutron/neutron.conf </span></span><br><span class="line">crudini --<span class="built_in">set</span> /etc/neutron/neutron.conf DEFAULT transport_url rabbit://openstack:123456@controller</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/neutron/neutron.conf DEFAULT auth_strategy keystone</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/neutron/neutron.conf keystone_authtoken auth_uri http://controller:5000</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/neutron/neutron.conf keystone_authtoken auth_url http://controller:5000</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/neutron/neutron.conf keystone_authtoken memcached_servers controller:11211</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/neutron/neutron.conf keystone_authtoken auth_type password</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/neutron/neutron.conf keystone_authtoken project_domain_name default</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/neutron/neutron.conf keystone_authtoken user_domain_name default</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/neutron/neutron.conf keystone_authtoken project_name service</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/neutron/neutron.conf keystone_authtoken username neutron</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/neutron/neutron.conf keystone_authtoken password 123456 </span><br><span class="line">crudini --<span class="built_in">set</span> /etc/neutron/neutron.conf oslo_concurrency lock_path /var/lib/neutron/tmp</span><br><span class="line"></span><br><span class="line"><span class="comment">#配置网络部分</span></span><br><span class="line"><span class="comment">#配置Linux网桥</span></span><br><span class="line"><span class="comment">#/etc/neutron/plugins/ml2/linuxbridge_agent.ini</span></span><br><span class="line">crudini --<span class="built_in">set</span> /etc/neutron/plugins/ml2/linuxbridge_agent.ini vxlan enable_vxlan <span class="literal">true</span></span><br><span class="line">crudini --<span class="built_in">set</span> /etc/neutron/plugins/ml2/linuxbridge_agent.ini vxlan local_ip 172.16.80.12</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/neutron/plugins/ml2/linuxbridge_agent.ini vxlan l2_population <span class="literal">true</span></span><br><span class="line">crudini --<span class="built_in">set</span> /etc/neutron/plugins/ml2/linuxbridge_agent.ini securitygroup enable_security_group <span class="literal">true</span></span><br><span class="line">crudini --<span class="built_in">set</span> /etc/neutron/plugins/ml2/linuxbridge_agent.ini securitygroup firewall_driver neutron.agent.linux.iptables_firewall.IptablesFirewallDriver</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/neutron/plugins/ml2/linuxbridge_agent.ini linux_bridge physical_interface_mappings provider:ens33</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">vim /etc/security/limits.conf</span><br><span class="line">*               soft    nofile            1024000</span><br><span class="line">*               hard    nofile            1024000</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#配置计算服务使用网络服务</span></span><br><span class="line"><span class="comment">#/etc/nova/nova.conf</span></span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf neutron url http://controller:9696</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf neutron auth_url http://controller:5000</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf neutron auth_type password</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf neutron project_domain_name default</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf neutron user_domain_name default</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf neutron region_name RegionOne</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf neutron project_name service</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf neutron username neutron</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf neutron password 123456</span><br><span class="line"></span><br><span class="line"><span class="comment">#确保您的Linux操作系统内核支持网桥过滤器，方法是验证以下所有sysctl值均设置为1：</span></span><br><span class="line">vim /usr/lib/sysctl.d/00-system.conf </span><br><span class="line">net.bridge.bridge-nf-call-iptables=1</span><br><span class="line">net.bridge.bridge-nf-call-ip6tables=1</span><br><span class="line">sysctl -p</span><br><span class="line"></span><br><span class="line"><span class="comment">#完成安装启动服务</span></span><br><span class="line"><span class="comment">#重启compute服务</span></span><br><span class="line">systemctl restart openstack-nova-compute.service</span><br><span class="line"><span class="comment">#设置网桥服务开机启动</span></span><br><span class="line">systemctl <span class="built_in">enable</span> neutron-linuxbridge-agent.service &amp;&amp; systemctl start neutron-linuxbridge-agent.service</span><br><span class="line"></span><br><span class="line"><span class="comment">#验证</span></span><br><span class="line"><span class="built_in">source</span> admin-openrc</span><br><span class="line">openstack extension list --network</span><br><span class="line">openstack network agent list</span><br></pre></td></tr></table></figure>

<h4 id="3-5-安装Horizon服务"><a href="#3-5-安装Horizon服务" class="headerlink" title="3.5 安装Horizon服务"></a>3.5 安装Horizon服务</h4><blockquote>
<p>controller</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#安装dashboard服务</span></span><br><span class="line">yum install openstack-dashboard -y </span><br><span class="line"></span><br><span class="line"><span class="comment">#修改配置文件</span></span><br><span class="line">vim /etc/openstack-dashboard/local_settings</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">OPENSTACK_HOST = <span class="string">&quot;controller&quot;</span>        <span class="comment">##配置界面在控制节点使用</span></span><br><span class="line"></span><br><span class="line">ALLOWED_HOSTS = [<span class="string">&#x27;*&#x27;</span>]               <span class="comment">##允许所有主机访问</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##配置memcached存储服务</span></span><br><span class="line">SESSION_ENGINE = <span class="string">&#x27;django.contrib.sessions.backends.cache&#x27;</span></span><br><span class="line">CACHES = &#123;</span><br><span class="line">    <span class="string">&#x27;default&#x27;</span>: &#123;</span><br><span class="line">        <span class="string">&#x27;BACKEND&#x27;</span>: <span class="string">&#x27;django.core.cache.backends.memcached.MemcachedCache&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;LOCATION&#x27;</span>: <span class="string">&#x27;controller:11211&#x27;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">OPENSTACK_KEYSTONE_URL = <span class="string">&quot;http://%s:5000/v3&quot;</span> % OPENSTACK_HOST  <span class="comment">##启动v3的认证api</span></span><br><span class="line"></span><br><span class="line">OPENSTACK_KEYSTONE_MULTIDOMAIN_SUPPORT = True       <span class="comment">##启用domain支持</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##配置api版本</span></span><br><span class="line">OPENSTACK_API_VERSIONS = &#123;              </span><br><span class="line">    <span class="string">&quot;data-processing&quot;</span>: 1.1,</span><br><span class="line">    <span class="string">&quot;identity&quot;</span>: 3,</span><br><span class="line">    <span class="string">&quot;image&quot;</span>: 2,</span><br><span class="line">    <span class="string">&quot;volume&quot;</span>: 2,</span><br><span class="line">    <span class="string">&quot;compute&quot;</span>: 2,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">OPENSTACK_KEYSTONE_DEFAULT_DOMAIN = <span class="string">&#x27;Default&#x27;</span>       <span class="comment">##配置Default为默认域</span></span><br><span class="line"></span><br><span class="line">OPENSTACK_KEYSTONE_DEFAULT_ROLE = <span class="string">&quot;user&quot;</span>                <span class="comment">##配置user角色为默认角色</span></span><br><span class="line"></span><br><span class="line">TIME_ZONE = <span class="string">&quot;Asia/Shanghai&quot;</span>                         <span class="comment">##配置时区</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#修改配置文件</span></span><br><span class="line">vim /etc/httpd/conf.d/openstack-dashboard.conf</span><br><span class="line">WSGIApplicationGroup %&#123;GLOBAL&#125; <span class="comment">#第四行添加</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#重启httpd服务和memcached服务</span></span><br><span class="line">systemctl restart httpd.service memcached.service</span><br><span class="line"></span><br><span class="line"><span class="comment">#浏览器输入ip</span></span><br><span class="line">http://172.16.80.11/dashboard</span><br><span class="line">=============================================================================</span><br><span class="line"><span class="comment">#搭建openstack The requested URL /auth/login/ was not found on this server报错</span></span><br><span class="line">vim /usr/share/openstack-dashboard/openstack_dashboard/local/local_settings.py</span><br><span class="line">WEBROOT = <span class="string">&#x27;/dashboard&#x27;</span></span><br><span class="line">==============================================================================</span><br></pre></td></tr></table></figure>

<blockquote>
<p>扩展 自己制作离线yum源</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">###############控制节点################</span></span><br><span class="line">yum -y install createrepo</span><br><span class="line"><span class="built_in">mkdir</span> -p /mnt/openstack/openstack_Train</span><br><span class="line"><span class="built_in">cd</span> /var/cache/yum/x86_64/7/</span><br><span class="line">find ./* -name <span class="string">&quot;*.rpm&quot;</span>  -<span class="built_in">exec</span> <span class="built_in">cp</span> &#123;&#125; /mnt/openstack/openstack_Train/ \; </span><br><span class="line"><span class="comment">###############计算节点################</span></span><br><span class="line"><span class="built_in">mkdir</span> -p /mnt/openstack/openstack_Train_compute</span><br><span class="line"><span class="built_in">cd</span> /var/cache/yum/x86_64/7/</span><br><span class="line">find ./* -name <span class="string">&quot;*.rpm&quot;</span>  -<span class="built_in">exec</span> <span class="built_in">cp</span> &#123;&#125; /mnt/openstack/openstack_Train_compute/ \;</span><br><span class="line">scp /mnt/openstack/openstack_Train_compute/* 192.168.200.10:/mnt/openstack/openstack_Train_compute</span><br><span class="line"></span><br><span class="line"><span class="comment">#到控制节点上把所有的rpm包都放到一起</span></span><br><span class="line"><span class="built_in">cd</span> /mnt/</span><br><span class="line"><span class="built_in">mv</span> -f openstack_Train_compute/*.rpm openstack_Train/</span><br><span class="line"></span><br><span class="line"><span class="comment">#创建yum</span></span><br><span class="line"><span class="built_in">cd</span> /mnt/openstack/openstack_Train</span><br><span class="line">createrepo ./</span><br><span class="line"><span class="built_in">ls</span> repodata/</span><br><span class="line"></span><br><span class="line"><span class="comment">#打包</span></span><br><span class="line">tar -zcvf openstack-train.tar.gz openstack_Train/</span><br><span class="line"></span><br><span class="line"><span class="comment">#这样就可以将tar包保存到本地，供以后使用</span></span><br><span class="line">1. 将tar包上传，解压到/mnt/</span><br><span class="line">2. 配置yum.repo文件，配置yum到本地目录</span><br><span class="line">3. 就可以使用不需要联网下载</span><br></pre></td></tr></table></figure>



<h4 id="3-6-安装Cinder服务"><a href="#3-6-安装Cinder服务" class="headerlink" title="3.6 安装Cinder服务"></a>3.6 安装Cinder服务</h4><blockquote>
<p>controller</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#安装和配置controller节点</span></span><br><span class="line"><span class="comment">#本节介绍如何在控制节点上安装和配置代码为cinder的块存储服务。 此服务至少需要一个为实例提供卷的额外存储节点。</span></span><br><span class="line"><span class="comment">#创建cinder数据库</span></span><br><span class="line"><span class="comment">#在安装和配置块存储服务之前，您必须创建数据库，服务凭据和API端点。</span></span><br><span class="line">mysql -u root -p123456</span><br><span class="line">CREATE DATABASE cinder;</span><br><span class="line">GRANT ALL PRIVILEGES ON cinder.* TO <span class="string">&#x27;cinder&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> IDENTIFIED BY <span class="string">&#x27;123456&#x27;</span>;</span><br><span class="line">GRANT ALL PRIVILEGES ON cinder.* TO <span class="string">&#x27;cinder&#x27;</span>@<span class="string">&#x27;%&#x27;</span> IDENTIFIED BY <span class="string">&#x27;123456&#x27;</span>;</span><br><span class="line">flush privileges;</span><br><span class="line"><span class="built_in">exit</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">source</span> admin-openrc</span><br><span class="line"><span class="comment">#要创建服务凭据</span></span><br><span class="line"><span class="comment">#创建一个cinder用户：</span></span><br><span class="line">openstack user create --domain default --password 123456 cinder</span><br><span class="line"><span class="comment">#添加admin角色到cinder用户：</span></span><br><span class="line">openstack role add --project service --user cinder admin</span><br><span class="line"><span class="comment">#创建cinderv2和cinderv3服务实体：</span></span><br><span class="line">openstack service create --name cinderv2 --description <span class="string">&quot;OpenStack Block Storage&quot;</span> volumev2</span><br><span class="line">openstack service create --name cinderv3 --description <span class="string">&quot;OpenStack Block Storage&quot;</span> volumev3</span><br><span class="line"><span class="comment">#创建块存储服务API端点：</span></span><br><span class="line">openstack endpoint create --region RegionOne volumev2 public http://controller:8776/v2/%\(project_id\)s</span><br><span class="line">openstack endpoint create --region RegionOne volumev2 internal http://controller:8776/v2/%\(project_id\)s</span><br><span class="line">openstack endpoint create --region RegionOne volumev2 admin http://controller:8776/v2/%\(project_id\)s</span><br><span class="line">openstack endpoint create --region RegionOne volumev3 public http://controller:8776/v3/%\(project_id\)s</span><br><span class="line">openstack endpoint create --region RegionOne volumev3 internal http://controller:8776/v3/%\(project_id\)s</span><br><span class="line">openstack endpoint create --region RegionOne volumev3 admin http://controller:8776/v3/%\(project_id\)s</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#安装和配置组件</span></span><br><span class="line">yum install openstack-cinder -y</span><br><span class="line"><span class="comment">#/etc/cinder/cinder.conf</span></span><br><span class="line">crudini --<span class="built_in">set</span> /etc/cinder/cinder.conf DEFAULT transport_url rabbit://openstack:123456@controller</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/cinder/cinder.conf DEFAULT auth_strategy keystone</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/cinder/cinder.conf DEFAULT my_ip 172.16.80.11</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/cinder/cinder.conf database connection mysql+pymysql://cinder:123456@controller/cinder</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/cinder/cinder.conf keystone_authtoken auth_uri http://controller:5000</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/cinder/cinder.conf keystone_authtoken auth_url http://controller:5000</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/cinder/cinder.conf keystone_authtoken memcached_servers controller:11211</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/cinder/cinder.conf keystone_authtoken auth_type password</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/cinder/cinder.conf keystone_authtoken project_domain_id default</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/cinder/cinder.conf keystone_authtoken user_domain_id default</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/cinder/cinder.conf keystone_authtoken project_name service</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/cinder/cinder.conf keystone_authtoken username cinder</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/cinder/cinder.conf keystone_authtoken password 123456</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/cinder/cinder.conf oslo_concurrency lock_path /var/lib/cinder/tmp</span><br><span class="line"></span><br><span class="line"><span class="comment">#同步块存储数据库：</span></span><br><span class="line">su -s /bin/sh -c <span class="string">&quot;cinder-manage db sync&quot;</span> cinder</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#配置计算服务使用块存储</span></span><br><span class="line"><span class="comment">#编辑/etc/nova/nova.conf文件并添加以下内容：</span></span><br><span class="line"><span class="comment">#/etc/nova/nova.conf</span></span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf os_region_name RegionOne</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#完成安装启动服务</span></span><br><span class="line"><span class="comment">#重新启动Compute API服务：</span></span><br><span class="line">systemctl restart openstack-nova-api.service</span><br><span class="line"><span class="comment">#启动块存储服务并将其配置为在系统引导时启动：</span></span><br><span class="line">systemctl <span class="built_in">enable</span> openstack-cinder-api.service openstack-cinder-scheduler.service</span><br><span class="line">systemctl restart openstack-cinder-api.service openstack-cinder-scheduler.service</span><br></pre></td></tr></table></figure>

<blockquote>
<p>compute</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#安装和配置cinder节点</span></span><br><span class="line"><span class="comment">#安装配置LVM</span></span><br><span class="line"><span class="comment">#安装支持的软件包 安装LVM软件包</span></span><br><span class="line">yum install lvm2 device-mapper-persistent-data -y</span><br><span class="line"><span class="comment">#启动LVM元数据服务并将其配置为在系统引导时启动：</span></span><br><span class="line">systemctl <span class="built_in">enable</span> lvm2-lvmetad.service &amp;&amp; systemctl start lvm2-lvmetad.service</span><br><span class="line"></span><br><span class="line"><span class="comment">#创建LVM物理逻辑卷/dev/sdb</span></span><br><span class="line">pvcreate /dev/sdb</span><br><span class="line"></span><br><span class="line"><span class="comment">#创建cinder-volumes逻辑卷组</span></span><br><span class="line">vgcreate cinder-volumes /dev/sdb</span><br><span class="line"></span><br><span class="line"><span class="comment">#只有实例才能访问块存储卷。 但是，底层操作系统管理与卷关联的设备。 默认情况下，LVM卷扫描工具会扫描包含卷的块存储设备的/ dev目录。 如果项目在其卷上使用LVM，则扫描工具将检测这些卷并尝试缓存它们，这可能会导致底层操作系统和项目卷出现各种问题。 您必须重新配置LVM以仅扫描包含cinder-volumes卷组的设备。 编辑/etc/lvm/lvm.conf文件并完成以下操作：</span></span><br><span class="line"><span class="comment">#在devices部分中，添加一个接受/ dev / sdb设备的过滤器并拒绝所有其他设备：</span></span><br><span class="line">vim /etc/lvm/lvm.conf</span><br><span class="line">devices &#123;</span><br><span class="line">filter = [ <span class="string">&quot;a/sdb/&quot;</span>, <span class="string">&quot;r/.*/&quot;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">#如果您的存储节点在操作系统磁盘上使用LVM，则还必须将关联的设备添加到过滤器。 例如，如果/ dev / sda设备包含操作系统：</span></span><br><span class="line">filter = [ <span class="string">&quot;a/sda/&quot;</span>, <span class="string">&quot;a/sdb/&quot;</span>, <span class="string">&quot;r/.*/&quot;</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#如果您的计算节点在操作系统磁盘上使用LVM，则还必须修改这些节点上/etc/lvm/lvm.conf文件中的筛选器以仅包含操作系统磁盘。 例如，如果/ dev / sda设备包含操作系统：</span></span><br><span class="line">filter = [ <span class="string">&quot;a/sda/&quot;</span>, <span class="string">&quot;r/.*/&quot;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">#安装和配置组件</span></span><br><span class="line"><span class="comment">#安装软件包</span></span><br><span class="line">yum install openstack-cinder targetcli python-keystone -y</span><br><span class="line"><span class="comment">#/etc/cinder/cinder.conf</span></span><br><span class="line">crudini --<span class="built_in">set</span> /etc/cinder/cinder.conf DEFAULT transport_url rabbit://openstack:123456@controller</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/cinder/cinder.conf DEFAULT auth_strategy keystone</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/cinder/cinder.conf DEFAULT my_ip 172.16.80.12</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/cinder/cinder.conf DEFAULT enabled_backends  lvm</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/cinder/cinder.conf DEFAULT glance_api_servers http://controller:9292</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/cinder/cinder.conf database connection mysql+pymysql://cinder:123456@controller/cinder</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/cinder/cinder.conf keystone_authtoken auth_uri http://controller:5000</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/cinder/cinder.conf keystone_authtoken auth_url http://controller:5000</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/cinder/cinder.conf keystone_authtoken memcached_servers controller:11211</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/cinder/cinder.conf keystone_authtoken auth_type password</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/cinder/cinder.conf keystone_authtoken project_domain_id default</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/cinder/cinder.conf keystone_authtoken user_domain_id default</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/cinder/cinder.conf keystone_authtoken project_name service</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/cinder/cinder.conf keystone_authtoken username cinder</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/cinder/cinder.conf keystone_authtoken password 123456</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/cinder/cinder.conf oslo_concurrency lock_path /var/lib/cinder/tmp</span><br><span class="line"><span class="comment">#自动添加</span></span><br><span class="line">crudini --<span class="built_in">set</span> /etc/cinder/cinder.conf lvm volume_driver cinder.volume.drivers.lvm.LVMVolumeDriver </span><br><span class="line">crudini --<span class="built_in">set</span> /etc/cinder/cinder.conf lvm volume_group cinder-volumes </span><br><span class="line">crudini --<span class="built_in">set</span> /etc/cinder/cinder.conf lvm iscsi_protocol iscsi </span><br><span class="line">crudini --<span class="built_in">set</span> /etc/cinder/cinder.conf lvm iscsi_helper lioadm</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#完成安装启动服务</span></span><br><span class="line"><span class="comment">#设置存储服务开机启动</span></span><br><span class="line">systemctl <span class="built_in">enable</span> openstack-cinder-volume.service target.service </span><br><span class="line">systemctl restart openstack-cinder-volume.service target.service</span><br></pre></td></tr></table></figure>

<blockquote>
<p>controller</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#验证cinder配置</span></span><br><span class="line"><span class="comment">#验证Cinder操作,在控制器节点上执行这些命令。</span></span><br><span class="line">. admin-openrc</span><br><span class="line"><span class="comment">#列出服务组件以验证每个进程的成功启动：</span></span><br><span class="line">openstack volume service list</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>云计算</category>
      </categories>
      <tags>
        <tag>OpenStack</tag>
        <tag>云计算大赛</tag>
      </tags>
  </entry>
  <entry>
    <title>test1</title>
    <url>/2023/02/01/test1/</url>
    <content><![CDATA[<span id="more"></span>

]]></content>
  </entry>
</search>
